<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>安装Noding</title>
    <!-- CSS only -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
      integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
      crossorigin="anonymous"
    />
    <!-- JS, Popper.js, and jQuery -->
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"
      integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.1.0/axios.min.js"></script>
    <style>
      .text-center {
        text-align: center;
      }
      .jumbotron {
            padding: 2rem 1rem;
        }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="jumbotron">
        <h1 class="display-4">Hello, Noding!</h1>
        <p class="lead">刚刚好，不多也不少.<div id="system-info"></div></p>
      </div>
      <div class="row">
        <div class="col mt-4">
          <div class="form-group">
              <label for="type">系统类型</label>
              <select class="custom-select mr-sm-2" id="version">
                <option selected value="basic">基础版</option>
                <option  value="next">进阶版</option>
                <option  value="pro">高级版</option>
              </select>
            </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <div class="card">
            <div class="card-header">数据库配置</div>
            <div class="card-body">
              <form id="db">
                <div class="form-group">
                  <label for="type">数据库类型</label>
                  <select class="custom-select mr-sm-2" id="db_type">
                    <option selected value="postgres">postgres</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="host">数据库地址</label>
                  <input
                    type="text"
                    class="form-control"
                    id="db_host"
                    placeholder="请输入数据库ip地址"
                  />
                </div>
                <div class="form-group">
                  <label for="host">数据库端口号</label>
                  <input
                    type="text"
                    class="form-control"
                    id="db_port"
                    placeholder="请输入数据库端口号"
                  />
                </div>
                <div class="form-group">
                  <label for="host">数据库用户名</label>
                  <input
                    type="text"
                    class="form-control"
                    id="db_username"
                    placeholder="请输入数据库用户名"
                  />
                </div>
                <div class="form-group">
                  <label for="host">数据库密码</label>
                  <input
                    type="password"
                    class="form-control"
                    id="db_password"
                    placeholder="请输入数据库密码"
                  />
                </div>
                <div class="form-group">
                  <label for="host">数据库库名</label>
                  <input
                    type="text"
                    class="form-control"
                    id="db_database"
                    placeholder="请输入数据库库名"
                  />
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card">
            <div class="card-header">缓存配置</div>
            <div class="card-body">
              <form id="redis">
                <div class="form-group">
                  <label for="host">redis 地址</label>
                  <input
                    type="text"
                    class="form-control"
                    id="redis_host"
                    placeholder="请输入redis 地址"
                  />
                </div>
                <div class="form-group">
                  <label for="host">redis 端口号</label>
                  <input
                    type="text"
                    class="form-control"
                    id="redis_port"
                    placeholder="请输入redis 端口号"
                  />
                </div>
                <div class="form-group">
                  <label for="host">redis 用户名</label>
                  <input
                    type="text"
                    class="form-control"
                    id="redis_username"
                    placeholder="请输入redis 用户名"
                  />
                </div>
                <div class="form-group">
                  <label for="host">redis 密码</label>
                  <input
                    type="text"
                    class="form-control"
                    id="redis_password"
                    placeholder="请输入redis 密码"
                  />
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card">
            <div class="card-header">消息队列配置</div>
            <div class="card-body">
              <form id="redis">
                <div class="form-group">
                  <label for="host">mq 地址</label>
                  <input
                    type="text"
                    class="form-control"
                    id="mq_host"
                    placeholder="请输入mq 地址"
                  />
                </div>
                <div class="form-group">
                  <label for="host">mq 端口号</label>
                  <input
                    type="text"
                    class="form-control"
                    id="mq_port"
                    placeholder="请输入mq 端口号"
                  />
                </div>
                <div class="form-group">
                  <label for="host">mq 用户名</label>
                  <input
                    type="text"
                    class="form-control"
                    id="mq_username"
                    placeholder="请输入mq 用户名"
                  />
                </div>
                <div class="form-group">
                  <label for="host">mq 密码</label>
                  <input
                    type="text"
                    class="form-control"
                    id="mq_password"
                    placeholder="请输入mq 密码"
                  />
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      
      <div class="row mt-4">
        <button
          type="button"
          id="install"
          class="btn btn-primary btn-lg btn-block"
        >
          立即安装
        </button>
      </div>
      <div class="mt-4"></div>
    </div>
    <script>
      axios.get("/systeminfo").then((res) => {
        const { cpus, version } = res;
        const systemInfo = document.getElementById("system-info");
        let html = ``;
        html += `<p><b>当前版本号：</b>${version}</p>`;
        html += `<p>请填写配置信息，完成安装!</p>`;
        systemInfo.innerHTML = html;
        versionDiv.innerHTML = `${version}`;
        console.log(res);
      });
      const installBtn = document.getElementById("install");
      installBtn.addEventListener("click", () => {
        const data = getData();
        axios.post("/install", data);
      });
      function getData() {
        return {
          version: getInputValueById('version'),
          db: {
            type: getInputValueById("db_type"),
            host: getInputValueById("db_host"),
            port: getInputValueById("db_port"),
            username: getInputValueById("db_username"),
            password: getInputValueById("db_password"),
            database: getInputValueById("db_database"),
          },
          redis: {
            host: getInputValueById("redis_host"),
            port: getInputValueById("redis_port"),
            username: getInputValueById("redis_username"),
            password: getInputValueById("redis_password"),
          },
          mq: {
            host: getInputValueById("mq_host"),
            port: getInputValueById("mq_port"),
            username: getInputValueById("mq_username"),
            password: getInputValueById("mq_password"),
          },
        };
      }
      function getElementById(id) {
        return document.getElementById(id);
      }
      function getInputValueById(id) {
        return getElementById(id).value;
      }
    </script>
  </body>
</html>
